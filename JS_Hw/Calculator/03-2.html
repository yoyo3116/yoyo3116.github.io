<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
  <Style>
    .container {

      overflow: hidden;
    }

    .calc {
      position: relative;
      width: 500px;
      margin: auto;
      border-radius: 8px;
    }

    .btn {
      padding: 30px 0px;
      box-sizing: border-box;
      margin: 0;
      border: 2px gray solid;
    }

    .screen input {
      background-color: rgba(0, 0, 0, .7) !important;
      border: none;
      color: white;
    }

    .row {
      flex-wrap: nowrap;

    }

    .operator {
      background-color: black;
      opacity: .7;
      color: white;
    }

    .num {
      background-color: black;
      color: white;

    }

    #submit {
      background-color: purple;
    }

    .historyArea {
      background-color: rgba(0, 0, 0, .9);
      height: 450px;
      width: 490px;
      color: white;
      position: absolute;
      bottom:-450px;
      left: 5px;
      transition: .5s;
      overflow: auto;
      flex-direction: column-reverse;
      display: flex;
    }
  </Style>
  <title>Hello, world!</title>

</head>

<body>
  <div class="container">
    <div class="calc mt-4 p-3">
      <div class="row">
        <div class="screen p-0">
          <input id="record" class="py-3 text-end fs-2 w-100" disabled type="text">
          <input id="show" class="py-3 text-end fs-1 w-100" disabled type="text" placeholder="0">
        </div>
      </div>
      <div class="row">
        <div class="buttonArea">
          <div class="row">
            <button class="col-6 operator hs btn">History</button>
            <button id="del" class="col-3 operator btn">C</button>
            <button id="back" class="col-3 operator btn">⇥</button>
          </div>
          <div class="row">
            <button class="col-3 operator topQ btn">1/x</button>
            <button class="col-3 operator topQ btn">x²</button>
            <button class="col-3 operator topQ btn">²√x</button>
            <button class="col-3 operator math btn" disabled >÷</button>
          </div>
          <div class="row number">
            <button class="col-3 btn num">7</button>
            <button class="col-3 btn num">8</button>
            <button class="col-3 btn num">9</button>
            <button class="col-3 operator math btn" disabled >×</button>
          </div>
          <div class="row  number">
            <button class="col-3 btn num">4</button>
            <button class="col-3 btn num">5</button>
            <button class="col-3 btn num">6</button>
            <button class="col-3 operator math btn" disabled >-</button>
          </div>
          <div class="row  number">
            <button class="col-3 btn num">1</button>
            <button class="col-3 btn num">2</button>
            <button class="col-3 btn num">3</button>
            <button class="col-3 operator math btn" disabled >+</button>
          </div>
          <div class="row  number">
            <button class="col-3 btn num">±</button>
            <button class="col-3 btn num">0</button>
            <button class="col-3 btn num">.</button>
            <button id="submit" class="col-3 operator btn">=</button>
          </div>
          <div class="historyArea p-4">

          </div>
        </div>
      </div>
    </div>
  </div>


  <script>
    let number = document.querySelectorAll('.number>.num');
    let input = document.querySelector('#show');
    let del = document.querySelector('#del');
    let back = document.querySelector('#back');
    let math = document.querySelectorAll('.math');
    let record = document.querySelector('#record');
    let submit = document.querySelector('#submit');
    let topQ = document.querySelectorAll('.topQ');
    let hs = document.querySelector('.hs');
    let historyArea = document.querySelector('.historyArea');

    let up = false
    hs.addEventListener('click', function (event) {
      if (up == false) {
        historyArea.style.transform = "translateY(-450px)"
        up = true
      } else {
        historyArea.style.transform = "translateY(0)"
        up = false
      }
    })

    topQ.forEach(x => {
      x.addEventListener('click', function (event) {
        if (input.value == '') { }
        else {
          switch (x.innerText) {
            case "1/x":
              record.value = `1/(${input.value})`
              input.value = 1 / Number(input.value)
              break;
            case "x²":
              record.value = `sqr(${input.value})`
              input.value = Math.pow(Number(input.value), 2)
              break;
            case "²√x":
              record.value = `√(${input.value})`
              input.value = Math.sqrt(Number(input.value))
              break;
          }
          historyArea.innerHTML += `<div class="text-end mb-2">${record.value}<br>${input.value}</div>`
        }


      })
    })


    del.addEventListener('click', function (event) {
      math.forEach(x=>{x.disabled = true})
      input.value = '';
      record.value = "";
      input.setAttribute("placeholder", 0);
      p = false
      H = true
      G = true
     
    })
    let p = false
    back.addEventListener('click', function (event) {
      if (Array.from(record.value).includes('=')) {
        record.value = ''
        p = true
      }
      else {
        if (p == true) { }
        else {
          let a = Array.from(input.value);
          a.pop(a.length - 1);
          input.value = a.join('');
          p = false
        }
      }



    })
    //加減乘除
    let calcss='';
    let temp = '';
    let calc = '';
    let G = true
    let changeCal = false
    let nowNum = 0
    math.forEach(x => {
      
      x.addEventListener('click', function (event) {
        input.setAttribute("placeholder", temp);
        calcss = event.target.innerText;
        console.log(calcss);
        
        if (!changeCal) {
          nowNum = input.value
          console.log('ww');
          record.value = `${input.value}${calcss}`
          input.value = ""
          changeCal = true
        }
        else {
          record.value = `${nowNum}${calcss}`
          
        }
        
        // if (G == true){
        //   record.value = calc;
        //   G = false}
        // else{
        //   record.value = temp+calc;
        //   console.log('aaa');
        // }
        H = true
      })
    })
    //等於判斷
    let H = true;
    let oldValue;
    submit.addEventListener('click', function () {
      //拆解 calcs 取得 加減乘除符號
      let calcs = Array.from(calc).pop(calc.length - 1);
      let a = Array.from(record.value)
      a.pop();
      //將拆後的陣列轉字串
      let b = a.join('')
      // console.log(b)
      //按下後 將加之前的數字放到上方
      record.value += `${input.value}=`
      //宣告 較舊的值 


      //判斷H
      if (H == true) {
        //這是按等於之前的值
        oldValue = Number(input.value)
        switch (calcs) {
          case "+":
            //按下之後的值 = 舊的上方值去掉,符號 + 
            input.value = Number(b) + Number(input.value);
            break;
          case "-":
            input.value = Number(b) - Number(input.value);
            break;
          case "×":
            input.value = Number(b) * Number(input.value);
            break;
          case "÷":
            input.value = Number(b) / Number(input.value);
            break;
        }
        H = false
      }
      else {
        switch (calcs) {
          case "+":
            //按下之後的值 = 舊的上方值去掉,符號 + 
            input.value = Number(input.value) + Number(oldValue)
            record.value = `${input.value - oldValue}${calcs}${oldValue}=`
            break;
          case "-":
            input.value = Number(input.value) - Number(oldValue)
            record.value = `${Number(input.value) + Number(oldValue)}${calcs}${oldValue}=`
            break;
          case "×":
            input.value = Number(input.value) * Number(oldValue)
            record.value = `${Number(input.value) / Number(oldValue)}${calcs}${oldValue}=`
            break;
          case "÷":
            input.value = Number(input.value) / Number(oldValue)
            record.value = `${Number(input.value) * Number(oldValue)}${calcs}${oldValue}=`
            break;
        }
      }










      historyArea.innerHTML += `<div class="text-end mb-2">${record.value}<br>${input.value}</div>`
      p = false
    })

    //給數字鍵功能
    number.forEach(x => {
      x.addEventListener('click', function (event) {
        math.forEach(x=>{x.disabled = false})
        changeCal = false
        //判斷正負數
        if (event.target.innerText == "±") {
          if (Array.from(input.value).includes('-')) {
            let a = Array.from(input.value);
            a.shift('-');
            input.value = a.join('');
          }
          else {
            let a = Array.from(input.value);
            a.unshift('-');
            input.value = a.join('');
          }
        }
        //判斷是否 . 
        else if (event.target.innerText == ".") {
          if (Array.from(input.value).includes('.')) {
            //不要動作
          }
          else {
            if (input.value == '') {
              input.value = '0.'
          
            }
            else {
              input.value += event.target.innerText
             
            }
          }
        }
        //判斷0
        else if (event.target.innerText == "0") {
          if (input.value == '' || input.value == '-') {
            //不要動作
          }

          else {
            input.value += event.target.innerText;
          }
        }
        else {
            input.value += event.target.innerText;
        }
        temp = input.value
      })
    })

  </script>
  <!-- Optional JavaScript; choose one of the two! -->

  <!-- Option 1: Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>

  <!-- Option 2: Separate Popper and Bootstrap JS -->
  <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>
    -->
</body>

</html>